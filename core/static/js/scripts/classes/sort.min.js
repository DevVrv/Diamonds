"use strict";class SortSystem{constructor(kwargs){this.viewContainer=this.getElement(kwargs.viewContainer),this.simpleContainer=this.getElement(kwargs.simpleContainer),this.simpleItems=this.getElements(kwargs.simpleItems,this.simpleContainer),this.advancedContainer=this.getElement(kwargs.advancedContainer),this.advancedDragBox=this.getElement(kwargs.advancedDragBox,this.advancedContainer),this.advancedOffBox=this.getElement(kwargs.advancedOffBox,this.advancedContainer),this.advancedItems=this.getElements(kwargs.advancedItems,this.advancedContainer),this.plusItems=this.getChilds(kwargs.plusItems,this.advancedItems),this.angleItems=this.getChilds(kwargs.angleItems,this.advancedItems),this.orderBy=["sale_price"],this.url=kwargs.url,this.advancedDataName=kwargs.advancedDataName,this.simpleDataName=kwargs.simpleDataName,this.clarityList=["I3","I2","I1","SI2","SI1","VS2","VS1","VVS2","VVS1","IF","FI"],this.cutList=["N/A","Fair","Good","Very Good","Ideal","Super Ideal","Excellent"],this.colorList=["M","L","K","J","I","H","G","F","E","D"],this.shapeList=["Round","Marquise","Asscher","Cushion","Emerald","Heart","Oval","Pear","Princess","Radiant","Another"],this.symmetryList=["N/A","Good","Very Good","Excellent"],this.polishList=["N/A","Good","Very Good","Excellent"],this.fluourList=["None","Faint","Medium","Strong","Very Strong"],this.labList=["IGI","GIA","GCAl","HDR"],this.extention=kwargs.extention}init(){return this.simpleSort(),this.advancedSort(),this.drag(),this.dragEvent(),this}debug(info=this){return console.log(info),this}getElement(selector,parent=document){return parent.querySelector(selector)}getElements(selector,parent=document){return[...parent.querySelectorAll(selector)]}getChilds(selector,parents){const nodes=[];return parents.map(parent=>{nodes.push(parent.querySelector(selector))}),nodes}updateValues(value,type="default"){if("default"==type)this.orderBy=this.orderBy.filter(order=>{if(order!==value&&order!==`-${value}`)return order}),this.orderBy.unshift(value);else if("reverse"==type)this.orderBy=this.orderBy.filter(order=>{if(order!==value&&order!==`-${value}`)return order}),this.orderBy.unshift(`-${value}`);else if("remove"==type)this.orderBy=this.orderBy.filter(order=>{if(order!==value&&order!==`-${value}`)return order});else if("update"==type){if(-1==this.orderBy.indexOf(value)){const index=this.orderBy.indexOf(`-${value}`);this.orderBy[index]=value}else if(-1!=this.orderBy.indexOf(value)){const index=this.orderBy.indexOf(value);this.orderBy[index]=`-${value}`}}else"drag"==type&&(this.orderBy=this.orderBy.filter(order=>{if(order!==value&&order!==`-${value}`)return order}));this.simpleUpdate(),this.advancedUpdate(),this.request()}cleanSimple(){this.simpleItems.map(item=>{item.classList.remove("active-1"),item.classList.remove("active-2")})}simpleSort(){this.simpleItems.map(item=>{item.onclick=()=>{if(item.classList.contains("active-1")||!item.classList.contains("active-1")&&!item.classList.contains("active-2")){this.cleanSimple(),item.classList.add("active-2");const value=item.dataset.ioSimpleSort;this.updateValues(value,"default")}else if(item.classList.contains("active-2")){this.cleanSimple(),item.classList.add("active-1");const value=item.dataset.ioSimpleSort;this.updateValues(value,"reverse")}}})}simpleUpdate(){this.cleanSimple(),this.simpleItems.map(item=>{const value=item.dataset.ioSimpleSort;value==this.orderBy[0]?item.classList.add("active-2"):`-${value}`==this.orderBy[0]&&item.classList.add("active-1")})}advancedPlus(){this.plusItems.map((item,index)=>{item.onclick=()=>{if(this.advancedItems[index].classList.contains("active-1")||this.advancedItems[index].classList.contains("active-2")){this.advancedItems[index].classList.remove("active-1"),this.advancedItems[index].classList.remove("active-2"),this.advancedOffBox.insertAdjacentElement("afterbegin",this.advancedItems[index]);const value=this.advancedItems[index].dataset.ioAdvancedSort;this.updateValues(value,"remove")}else{this.advancedItems[index].classList.add("active-2"),this.advancedDragBox.insertAdjacentElement("afterbegin",this.advancedItems[index]);const value=this.advancedItems[index].dataset.ioAdvancedSort;this.updateValues(value,"default")}}})}advancedAngle(){this.angleItems.map((angle,index)=>{angle.onclick=()=>{if(this.advancedItems[index].classList.contains("active-1")){this.advancedItems[index].classList.remove("active-1"),this.advancedItems[index].classList.add("active-2");const value=this.advancedItems[index].dataset.ioAdvancedSort;this.updateValues(value,"update")}else if(this.advancedItems[index].classList.contains("active-2")){this.advancedItems[index].classList.remove("active-2"),this.advancedItems[index].classList.add("active-1");const value=this.advancedItems[index].dataset.ioAdvancedSort;this.updateValues(value,"update")}}})}advancedUpdate(){this.advancedItems.map(item=>{this.advancedOffBox.insertAdjacentElement("afterbegin",item),item.classList.remove("active-1"),item.classList.remove("active-2")}),this.orderBy.map(order=>{this.advancedItems.map(item=>{const value=item.dataset.ioAdvancedSort;order==value?(item.classList.add("active-2"),this.advancedDragBox.insertAdjacentElement("beforeend",item)):order==`-${value}`&&(item.classList.add("active-1"),this.advancedDragBox.insertAdjacentElement("beforeend",item))})})}advancedSort(){this.advancedPlus(),this.advancedAngle()}drag(){this.dragObject=new Sortable(this.advancedDragBox,{animation:150,handle:".drag-handle"})}dragEvent(){this.advancedItems.forEach(element=>{element.ondragend=()=>{const values=[],dragItems=this.getElements("[data-io-advanced-sort]",this.advancedDragBox);dragItems.map(item=>{if(item.classList.contains("active-1")){const value=`-${item.dataset.ioAdvancedSort}`;values.push(value)}else if(item.classList.contains("active-2")){const value=item.dataset.ioAdvancedSort;values.push(value)}}),this.orderBy=values,this.simpleUpdate()}})}request(){this.requestData={compare:!1,order:this.orderBy},"compare"==this.orderBy[0]||"-compare"==this.orderBy[0]?(this.requestData.compare=JSON.parse(localStorage.getItem("cart")),this.requestData.order=this.requestData.order.filter(value=>{if("compare"!==value&&"-compare"!==value)return value}),this.requestData.compare=this.requestData.compare.map(value=>value.replace("chb_","")),this.requestData.compare_order=this.orderBy[0]):(this.orderBy=this.orderBy.filter(value=>"compare"!==value&&"-compare"!==value),this.requestData.order=this.orderBy),this.viewContainer.innerHTML=this.getSpiner("get"),ajax(this.url,this.requestData,this.responce,this)}responce(responce,context){context.getSpiner("has")&&context.getSpiner("remove");const responceData=JSON.parse(responce);responceData.map(diamond=>{context.viewContainer.insertAdjacentHTML("beforeend",getDiamondHTML(diamond))});const diamondItem=new ElementsControl({manager:".result__item-list",managed:".result__drop-down"});diamondItem.toggler({single:!0,notThis:".label-result"});const diamondMoreInfo=new ElementsControl({manager:".btn-more--info",managed:".body-more--info"});if(diamondMoreInfo.toggler({single:!0}),void 0!==context.extention&&null!==context.extention){const diamondLabel=new ElementsControl({manager:'[data-io-label="diamonds-item"]',managed:".checkbox-results"});diamondLabel.label(context.extention.checked,context.extention.unchecked),context.extention.selected()}}getSpiner(action="get"){if("get"==action){const spin='            \n            <div class="text-center text-primary py-4 shadow-sm w-100 bg-lite border-bottom border-top my-1" id="loading-spiner">\n                <div class="spinner-border" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n            </div>\n            ';return spin}if("remove"==action){const spin=this.viewContainer.querySelector("#loading-spiner");null!=spin&&spin.remove()}else if("has"==action){const spin=this.viewContainer.querySelector("#loading-spiner");return null!=spin}}}