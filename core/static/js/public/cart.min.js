"use strict";class Cart{constructor(t){this.deleteButton=document.querySelector(t.deleteButton),this.activeKey="cart",this.container=document.querySelector(t.container),this.formBuy=document.querySelector(t.formBuy),this.formHold=document.querySelector(t.formHold),this.formMemo=document.querySelector(t.formMemo),this.total_carat=document.querySelector(t.total_carat),this.total_price=document.querySelector(t.total_price),this.total_stone=document.querySelector(t.total_stone),this.cart_length=document.querySelector(t.cart_length),this.init()}init(){return localStorage.setItem("cart",JSON.stringify([])),this.deleteSelected(),this.getFormData(this.formBuy,this),this.getFormData(this.formMemo,this),this.getFormData(this.formHold,this),this}debug(t=this){return console.log(t),this}unchecked(t){let e=JSON.parse(localStorage.getItem("cart"));e=e.filter(e=>{if(e!==t)return e}),localStorage.setItem("cart",JSON.stringify(e))}checked(t){const e=JSON.parse(localStorage.getItem("cart"));e.push(t),localStorage.setItem("cart",JSON.stringify(e))}removeByKey(t,e=document){t.map(t=>{const o=e.querySelector(`#${t}`),r=o.closest(".result-section--element");r.remove()})}deleteSelected(){this.deleteButton.addEventListener("click",()=>{let t=JSON.parse(localStorage.getItem("cart"));this.removeByKey(t,this.container),localStorage.setItem("cart",JSON.stringify([])),0!==t.length&&(t=t.map(t=>t.replace("chb_","")),ajax("delete_selected/",t,this.afterDelete,this))})}afterDelete(t,e){e.total_price.textContent=t.total_price,e.total_carat.textContent=t.total_carat,e.total_stone.textContent=t.total_stone,e.cart_length.textContent=t.total_stone}afterSubmit(t,e){e.container.innerHTML="",e.total_price.textContent=0,e.total_carat.textContent=0,e.total_stone.textContent=0,void 0!==e.cart_length&&null!==e.cart_length&&e.cart_length.remove(),e.alert(t.alert,e.submitedForm)}alert(t,e){const o='\n        <div class="alert alert-danger border-0 shadow-sm" role="alert" id="responce_message">\n            <h5 class="h5">Error: The basket cannot be empty</h5>\n            You can get acquainted with the goods by following this link\n            <a href="/" class="fs-5 link">Diamonds</a>\n        </div>\n        ',r='\n        <div class="alert alert-success border-0 shadow-sm" role="alert" id="responce_message">\n           <h5 class="h5">Success: your request was placed!</h5> <br>\n            You can view it at this link <a href="/orders/" class="fs-5 link">Orders</a>\n        </div>\n        ';let a="";"success"==t?a=r:"error"==t&&(a=o);const n=e.querySelector("#responce_message");null!=n&&n.remove();const l=e.querySelector(".modal-body");l.insertAdjacentHTML("afterbegin",a)}getFormData(t,e){t.onsubmit=(o=>{e.submitedForm=t,o.preventDefault();const r={},a=[...t.querySelectorAll("input, textarea")];a.map(t=>{("radio"==t.type&&t.checked||"radio"!==t.type)&&(r[t.name]=t.value)});for(let t in r)"pay_within"!=t&&"p_ct_offer"!=t&&"total_price_offer"!=t||(r[t]=0);ajax("/orders/create/",r,this.afterSubmit,this)})}selected(){const t=JSON.parse(localStorage.getItem("cart")),e=t.map(t=>this.container.querySelector(`#${t}`));e.map(t=>{t.checked=!0,t.parentElement.classList.add("active")})}}document.addEventListener("DOMContentLoaded",()=>{function t(){const t=document.querySelector("#hours-item"),e=t.querySelector("#hold-hours--title"),o=t.querySelectorAll(".hold-hours__select"),r=t.querySelector("#hold-hours--option");t.addEventListener("click",()=>{t.classList.toggle("active")}),o.forEach(t=>{t.addEventListener("click",()=>{let o=t.textContent;e.textContent=o,r.value=o})})}const e=new Cart({deleteButton:"#delete-selected",container:"#cart-items",formBuy:"#form-buy",formMemo:"#form-memo",formHold:"#form-hold",total_price:"#total_price",total_carat:"#total_carat",total_stone:"#total_stone",cart_length:"#cart_length"}).init(),o=new ElementsControl({manager:".result__item-list",managed:".result__drop-down"});o.toggler({single:!0,notThis:".label-result"});const r=new ElementsControl({manager:".btn-more--info",managed:".body-more--info"});r.toggler({single:!0});const a=new ElementsControl({manager:'[data-io-label="diamonds-item"]',managed:".checkbox-results"});a.label(e.checked,e.unchecked),t();new ScrollFix({container:"#cart-items"});const n=new SortSystem({viewContainer:"#cart-items",simpleContainer:"#cart_simple_sort",simpleItems:"[data-io-simple-sort]",advancedContainer:"#cart-sort-modal",advancedDragBox:"#cart-name-priority",advancedOffBox:"#cart-name-sort",advancedItems:"[data-io-advanced-sort]",plusItems:".fa-plus",angleItems:".fa-angle-down",url:"sort/",extention:e});n.init()});