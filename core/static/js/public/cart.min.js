"use strict";class Cart{constructor(kwargs){this.deleteButton=document.querySelector(kwargs.deleteButton),this.activeKey="cart",this.container=document.querySelector(kwargs.container),this.formBuy=document.querySelector(kwargs.formBuy),this.formHold=document.querySelector(kwargs.formHold),this.formMemo=document.querySelector(kwargs.formMemo),this.total_carat=document.querySelector(kwargs.total_carat),this.total_price=document.querySelector(kwargs.total_price),this.total_stone=document.querySelector(kwargs.total_stone),this.cart_length=document.querySelector(kwargs.cart_length),this.init()}init(){return localStorage.setItem("cart",JSON.stringify([])),this.deleteSelected(),this.orderSubmit(this.formBuy,this),this.orderSubmit(this.formMemo,this),this.orderSubmit(this.formHold,this),this}debug(info=this){return console.log(info),this}unchecked(value){let values=JSON.parse(localStorage.getItem("cart"));values=values.filter(v=>{if(v!==value)return v}),localStorage.setItem("cart",JSON.stringify(values))}checked(value){const values=JSON.parse(localStorage.getItem("cart"));values.push(value),localStorage.setItem("cart",JSON.stringify(values))}deleteSelected(){this.deleteButton.addEventListener("click",()=>{let deleteValues=JSON.parse(localStorage.getItem("cart"));this.removeByKey(deleteValues,this.container),localStorage.setItem("cart",JSON.stringify([])),0!==deleteValues.length&&(deleteValues=deleteValues.map(value=>value.replace("chb_","")),ajax("delete_selected/",deleteValues,this.afterDelete,this))})}removeByKey(pks,parent=document){pks.map(key=>{const node=parent.querySelector(`#${key}`),elem=node.closest(".result-section--element");elem.remove()})}afterDelete(responce,context){context.total_price.textContent=responce.total_price,context.total_carat.textContent=responce.total_carat,context.total_stone.textContent=responce.total_stone,context.cart_length.textContent=responce.total_stone}orderSubmit(form){form.addEventListener("submit",e=>{e.preventDefault();const button=form.querySelector('button[type="submit"]'),button_text=button.querySelector(".order-btn-text"),button_main_text=button_text.textContent;button_text.textContent="Order creating",button.classList.add("active"),button.setAttribute("disabled",!0),this.active_button={text:button_main_text,btn_text:button_text,btn:button};const formData={},inputs=[...form.querySelectorAll("input, textarea")];inputs.map(input=>{("radio"==input.type&&input.checked||"radio"!==input.type)&&(formData[input.name]=input.value)});for(let key in formData)"pay_within"!=key&&"p_ct_offer"!=key&&"total_price_offer"!=key||(formData[key]=0);ajax("/orders/create/",formData,this.afterSubmit,this)})}afterSubmit(responce,context){const shopping_alert=document.querySelector(".shopping_alert"),forms=[context.formBuy.parentElement.parentElement,context.formMemo.parentElement.parentElement,context.formHold.parentElement.parentElement],close_btns=[];forms.map(form=>{let btn=form.querySelector(".btn-close");close_btns.push(btn)}),close_btns.map(btn=>{btn.click()});const btn=context.active_button.btn,btn_text=context.active_button.btn_text,btn_old_text=context.active_button.text;btn.classList.remove("active"),btn.removeAttribute("disabled"),btn_text.textContent=btn_old_text,"success"==responce.alert?shopping_alert.innerHTML='<div class="alert alert-success mt-2 shadow-sm alert-dismissible fade show border-0" role="alert">\n                                            <div class="my-2">\n                                                <div class="d-flex align-items-center justify-content-center">\n                                                    <i class="fa fa-exclamation-circle me-2 fs-5" aria-hidden="true"></i>\n                                                    <h5 class="h5 m-0 p-0">Your order was created ! Go to <a href="/orders/" class="link">Orders</a></h5>\n                                                </div>\n                                                <button type="button" class="btn-close shadow-none border-none" data-bs-dismiss="alert" aria-label="Close"></button>\n                                            </div>\n                                        </div>\n            ':"empty"==responce.alert?shopping_alert.innerHTML='<div class="alert alert-warning mt-2 shadow-sm alert-dismissible fade show border-0" role="alert">\n                                            <div class="my-2">\n                                                <div class="d-flex align-items-center justify-content-center">\n                                                    <i class="fa fa-exclamation-circle me-2 fs-5" aria-hidden="true"></i>\n                                                    <h5 class="h5 m-0 p-0">Shopping cart can not be empty !</h5>\n                                                </div>\n                                                <button type="button" class="btn-close shadow-none border-none" data-bs-dismiss="alert" aria-label="Close"></button>\n                                            </div>\n                                        </div>\n            ':"error"==responce.alert&&(shopping_alert.innerHTML='<div class="alert alert-danger mt-2 shadow-sm alert-dismissible fade show border-0" role="alert">\n                                            <div class="my-2">\n                                                <div class="d-flex align-items-center justify-content-center">\n                                                    <i class="fa fa-exclamation-circle me-2 fs-5" aria-hidden="true"></i>\n                                                    <h5 class="h5 m-0 p-0">Something was wrong, order was not created</h5>\n                                                </div>\n                                                <button type="button" class="btn-close shadow-none border-none" data-bs-dismiss="alert" aria-label="Close"></button>\n                                            </div>\n                                        </div>\n            '),context.container.innerHTML='<div class="w-100 py-4 d-flex align-items-center justify-content-center border flex-column">\n                                            <h3 class="h3 text-success">Your shopping cart is empty</h3>\n                                            <p class="text-dark fs-5">\n                                                <span>\n                                                    Go to Products\n                                                <span>\n                                                <a href="/filter/" class="text-success">Filter</a>\n                                            </span></span></p>\n                                        </div>'}}document.addEventListener("DOMContentLoaded",()=>{const cart=new Cart({deleteButton:"#delete-selected",container:"#cart-items",formBuy:"#form-buy",formMemo:"#form-memo",formHold:"#form-hold",total_price:"#total_price",total_carat:"#total_carat",total_stone:"#total_stone",cart_length:"#cart_length"}),diamondItem=new ElementsControl({manager:".result__item-list",managed:".result__drop-down"});diamondItem.toggler({single:!0,notThis:".label-result"});const diamondMoreInfo=new ElementsControl({manager:".btn-more--info",managed:".body-more--info"});diamondMoreInfo.toggler({single:!0});const diamondLabel=new ElementsControl({manager:'[data-io-label="diamonds-item"]',managed:".checkbox-results"});function hoursToggle(){const hours=document.querySelector("#hours-item"),hoursValue=hours.querySelector("#hold-hours--title"),hoursItems=hours.querySelectorAll(".hold-hours__select"),hoursInput=hours.querySelector("#hold-hours--option");hours.addEventListener("click",()=>{hours.classList.toggle("active")}),hoursItems.forEach(elem=>{elem.addEventListener("click",()=>{let value=elem.textContent;hoursValue.textContent=value,hoursInput.value=value})})}diamondLabel.label(cart.checked,cart.unchecked),hoursToggle();const scrollFix=new ScrollFix({container:"#cart-items"}),cartSort=new SortSystem({viewContainer:"#cart-items",simpleContainer:"#cart_simple_sort",simpleItems:"[data-io-simple-sort]",advancedContainer:"#cart-sort-modal",advancedDragBox:"#cart-name-priority",advancedOffBox:"#cart-name-sort",advancedItems:"[data-io-advanced-sort]",plusItems:".fa-plus",angleItems:".fa-angle-down",url:"sort/",extention:cart});cartSort.init()});